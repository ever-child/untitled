<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>个人通讯录管理系统</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <style type="text/css">
	.childBody {
        padding: 15px;
    }

    .layui-btn-sm {
        line-height: normal;
        font-size: 12.5px;
    }

    .layui-table-view .layui-table-body {
        min-height: 256px;
    }

    .layui-table-cell .layui-input.layui-unselect {
        height: 30px;
        line-height: 30px;
    }

    .table-overlay .layui-table-view,
    .table-overlay .layui-table-box,
    .table-overlay .layui-table-body {
        overflow: visible;
    }

    .table-overlay .layui-table-cell {
        height: auto;
        overflow: visible;
    }

    /*文本对齐方式*/
    .text-center {
        text-align: center;
    }
    /*文本对齐方式*/
    .text-left {
        text-align: left;
        font-weight:200;
    }
</style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">个人通讯录管理系统</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a href="">通讯录</a></li>
            <li class="layui-nav-item"><a href="">用户管理</a></li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    测试用户
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">基本资料</a></dd>
                    <dd><a href="">安全设置</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a href="">退出登录</a></li>
        </ul>
    </div>

    <div class="layui-side layui-bg-cyan">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree"  lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="layui-bg-cyan" href="javascript:;">通讯录列表</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">通讯录一</a></dd>
                        <dd><a href="javascript:;">通讯录二</a></dd>
                        <dd><a href="javascript:;">通讯录三</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item layui-bg-cyan">
                    <a href="javascript:;">通讯录编辑</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="layui-body">
        <section class="layui-col-md10" style="margin: 0 auto; float: none;">
            <div class="layui-card">
                <div id="toolbar" class="layui-form-item">

                </div>
                <div id="tableRes" class="table-overlay">
                    <table id="dataTable" lay-filter="dataTable" class="layui-hide"></table>
                </div>
                <div class="text-center">
                    <button type="button" class="layui-btn layui-btn-normal" data-type="addRow" title="添加联系人">
                        <i class="layui-icon layui-icon-add-1"></i> 添加联系人
                    </button>
                    <button class="layui-btn" lay-submit="" lay-filter="formDemo">保存</button>
                </div>
            </div>

<!--            <div class="layui-card">-->
<!--                <div class="layui-card-header">数据输出显示：</div>-->
<!--                <div class="layui-card-body layui-text">-->
<!--                    <blockquote class="layui-elem-quote layui-quote-nm">-->
<!--                        <pre id="jsonResult"><span class="layui-word-aux">请点击“提交”后查看输出信息……</span></pre>-->
<!--                    </blockquote>-->
<!--                </div>-->
<!--            </div>-->
        </section>
    </div>

    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © EVERCHiLD 2020
    </div>
</div>
<script src="layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
var companyContactsDetailList = new Array();
	var typeList = new Array();
	var detailLists = new Array();
	//数据格式
	detailLists=[{name : "王浩宇", tel : "18736409666", qq : "2441143162", email : "me@haoyuwang.work", addr : "北京邮电大学"}]
window.viewObj = {
        tbData: detailLists,
        typeData: typeList,
        renderSelectOptions: function (data, settings) {
            settings = settings || {};
            var valueField = settings.valueField || 'value',
                textField = settings.textField || 'text',
                selectedValue = settings.selectedValue || "";
            var html = [];
            for (var i = 0, item; i < data.length; i++) {
                item = data[i];
                html.push('<option value="');
                html.push(item[valueField]);
                html.push('"');
                if (selectedValue && item[valueField] == selectedValue) {
                    html.push(' selected="selected"');
                }
                html.push('>');
                html.push(item[textField]);
                html.push('</option>');
            }
            return html.join('');
        }
    };
    layui.use(['jquery', 'table', 'form', 'layer'], function () {
        var $ = layui.$;
        var form = layui.form;
        var layer = layui.layer;
        var table = layui.table;
        //数据表格实例化
        var tbWidth = $("#tableRes").width();
        var layTableId = "layTable";
        var tableIns = table.render({
            elem: '#dataTable',
            id: layTableId,
            data: viewObj.tbData,
            width: tbWidth,
            loading: true,
            //不开启分页
			page:false,
            limit:1000,
            even: false,
            cols: [[
                {field: 'name', title: '姓名', edit: 'text'},
                {field: 'tel', title: '电话', edit: 'text'},
                {field: 'qq', title: 'QQ', edit: 'text'},
                {field: 'email', title: '邮箱', edit: 'text'},
                {field: 'addr', title: '住址', edit: 'text'},
                {
                    field: 'tempId', title: '操作', templet: function (d) {
                        return '<a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del" lay-id="' + d.tempId + '"><i class="layui-icon layui-icon-delete"></i>移除</a>';
                    }
                }
            ]],
            done: function (res, curr, count) {
                viewObj.tbData = res.data;
            }
        });
        //定义事件集合
        var active = {
			//添加事件
            addRow: function () {
			//添加一行
                var oldData = table.cache[layTableId];
                console.log(oldData);
                var newRow = {name : "", tel : "", qq : "", email : "", addr : ""};
                oldData.push(newRow);
                tableIns.reload({
                    data: oldData
                });
				 form.render();
            },
			//更新事件
            updateRow: function (obj) {
                var oldData = table.cache[layTableId];
             //   console.log(oldData);
                for (var i = 0, row; i < oldData.length; i++) {
                    row = oldData[i];
                    if (row.tempId == obj.tempId) {
                        $.extend(oldData[i], obj);
                        return;
                    }
                }
                tableIns.reload({
                    data: oldData
                });
            },
			//删除事件
            removeEmptyTableCache: function () {
                var oldData = table.cache[layTableId];
                for (var i = 0, row; i < oldData.length; i++) {
                    row = oldData[i];
                    if (!row || !row.tempId) {
					 //删除一项
                        oldData.splice(i, 1);
                    }
                    continue;
                }
                tableIns.reload({
                    data: oldData
                });
            }
        }

        //激活事件
        var activeByType = function (type, arg) {
            if (arguments.length === 2) {
                active[type] ? active[type].call(this, arg) : '';
            } else {
                active[type] ? active[type].call(this) : '';
            }
        }

        //提交按钮事件
        $('.layui-btn[data-type]').on('click', function () {
            var type = $(this).data('type');
            activeByType(type);
        });

        //监听select下拉选中事件
        form.on('select(type)', function(data){
		//得到select原始DOM对象
            var elem = data.elem;
            $(elem).prev("a[lay-event='type']").trigger("click");
        });

        //监听工具条
        table.on('tool(dataTable)', function (obj) {
		//获得当前行 tr 的DOM对象;
            var data = obj.data, event = obj.event, tr = obj.tr;
          //  console.log(data);
            switch (event) {
                case "type":
                    //console.log(data);
                    var select = tr.find("select[name='type']");
                    if (select) {
                        var selectedVal = select.val();
                        if (!selectedVal) {
						//吸附提示
                            layer.tips("请选择一个类型", select.next('.layui-form-select'), {tips: [3, '#FF5722']});
                        }
                       // console.log(selectedVal);
                        $.extend(obj.data, {'typeId': selectedVal});
						//更新行记录对象
                        activeByType('updateRow', obj.data);
                    }
                    break;

                case "del":
                    layer.confirm('确认删除这一行吗？', function (index) {
					//删除对应行（tr）的DOM结构，并更新缓存
                        obj.del();
                        layer.close(index);
                        activeByType('removeEmptyTableCache');
                    });
                    break;
            }
        });

        form.on('submit(formDemo)', function (data) {
            var oldData = table.cache[layTableId];
           // console.log(oldData);
            for (var i = 0, row; i < oldData.length; i++) {
                row = oldData[i];
                if (!row.name) {
				//提示
                    layer.msg("检查每一行，请选择类型！", {icon: 5});
                    return false;
                }
                if (!row.qq) {
				//提示
                    layer.msg("检查每一行，请选择类型！", {icon: 5});
                    return false;
                }if (!row.email) {
				//提示
                    layer.msg("检查每一行，请选择类型！", {icon: 5});
                    return false;
                }
                if (!row.addr) {
				//提示
                    layer.msg("检查每一行，请输入号码！", {icon: 5});
                    return false;
                }
                var companyContactsDetail = {
                    "contactsType": row.typeId,
                    "contactsCode": row.tel
                };
                companyContactsDetailList.push(companyContactsDetail)
            }
			//使用JSON.stringify() 格式化输出JSON字符串
			document.getElementById("jsonResult").innerHTML = JSON.stringify(table.cache[layTableId], null, 2);

            console.log(json);
			//使用JSON.stringify() 格式化输出JSON字符串
            var json = JSON.stringify(table.cache[layTableId], null, 2);
			//后台
			// var url = prefix;
			// var param = {
			//     "companyContactsDetailList": companyContactsDetailList
			// };
			// $.ajax({
			//     cache: true,
			//     url: url,
			//     type: "POST",
			//     contentType: "application/json;charset=UTF-8",
			//     data : JSON.stringify(param),
			//     async: false,
			//     error: function (request) {
			//         layer.alert('系统错误');
			//     },
			//     success: function (result) {
			//         if (result.code !== web_status.SUCCESS) {
			//             layer.alert(result.msg);
			//             return;
			//         }
			//         layer.msg(result.msg, {icon: 1}, function () {
			//             //成功跳转
			//         });
			//     }
			// });
				return false;
			});

    });
//JavaScript代码区域
layui.use('element', function(){
  var element = layui.element;

});
</script>
</body>
</html>